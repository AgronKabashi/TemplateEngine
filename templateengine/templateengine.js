"use strict";!function(a){var b={},c={registerModel:function(a,c){b[a]=c},getModelType:function(a){return b[a]},instantiateModel:function(a,c){return new b[a](c)}};a.module("Cerberus.ModelFactory",[]).factory("Cerberus.ModelFactory",function(){return c}),a.extend(a.module("Cerberus.ModelFactory"),c)}(window.angular),function(a,b,c){var d=c.getElementsByTagName("script"),e=d[d.length-1],f=c.location.origin.substr(0,c.location.href.lastIndexOf("/")+1),g=e.src.substr(0,e.src.lastIndexOf("/")+1).replace(f,""),h=a.module("Cerberus.TemplateEngine",["ngSanitize","Cerberus.ModelFactory"]).constant("templateEnginePath",g);b&&b.amd&&b([],h)}(window.angular,window.define,window.document),function(){String.format=function(){var a=arguments,b=a[0];return b.replace(/{(\d+)}/g,function(b,c){return c=~~c+1,"undefined"!=typeof a[c]?a[c]:b})},window.tryParseInt=function(a){var b=parseInt(a);return isNaN(b)?0:b},JSON.tryParse=function(a,b){var c;try{c=this.parse(a)}catch(d){c=b}return c}}(),function(a){a.module("Cerberus.TemplateEngine").controller("Cerberus.TemplateEngine.Controller.Component.Basic.RTF",function(){})}(window.angular),function(a){a.module("Cerberus.TemplateEngine").controller("Cerberus.TemplateEngine.Controller.Component.Basic.Text",function(){})}(window.angular),function(a){a.module("Cerberus.TemplateEngine").controller("Cerberus.TemplateEngine.Controller.Component.Basic.Video",[a.noop]).directive("csVideo",[function(){return{restrict:"A",link:function(a,b){var c=b.get(0),d=c.getElementsByTagName("source"),e=d[0],f=d[1],g=a.$watch("component.content",function(){var b=a.component.content,d=!1,g=e.getAttribute("src")||void 0,h=f.getAttribute("src")||void 0;c.preload=b.autoPlay?"auto":"metadata",c.loop=b.loopInfinitely,c.controls=b.showControls,c.autoplay=b.autoPlay,g!==b.mp4SourceUrl&&(b.mp4SourceUrl?e.setAttribute("src",b.mp4SourceUrl):e.removeAttribute("src"),d=!0),h!==b.oggSourceUrl&&(b.oggSourceUrl?f.setAttribute("src",b.oggSourceUrl):f.removeAttribute("src"),d=!0),d&&c.load()},!0);a.$on("$destroy",g)}}}])}(window.angular),function(a){a.module("Cerberus.TemplateEngine").controller("Cerberus.TemplateEngine.Controller.Component.Basic.YouTube",["$scope",function(a){var b="http://www.youtube.com/embed/{0}?wmode=transparent&start={1}&autoplay={2}&controls={3}&disablekb={4}&loop={5}&modestbranding={6}&showinfo={7}",c=a.$watch("component.content",function(){var c=a.component.content;return c.videoId?void(a.videoUrl=String.format(b,c.videoId,~~c.startTime,~~c.autoPlay,~~c.showControls,~~c.disableKeyboard,~~c.loopInfinitely,~~c.hideYouTubeBrand,~~c.showVideoInfo)):void(a.videoUrl="about:blank")},!0);a.$on("$destroy",c)}])}(window.angular),function(a){a.module("Cerberus.TemplateEngine").controller("Cerberus.TemplateEngine.Controller.Component.Navigation.Link",["$scope",function(a){a.content=a.component.content}])}(window.angular),function(a){a.module("Cerberus.TemplateEngine").controller("Cerberus.TemplateEngine.Controller.Component.SocialMedia.Rss",["$scope","$http",function(a,b){function c(c){return c?void b.jsonp(String.format(d,encodeURIComponent(c))).then(function(b){a.rssFeed=a.stories=void 0,b.data.responseData&&(a.rssFeed=b.data.responseData.feed,a.stories=a.rssFeed.entries)}):void(a.rssFeed=a.stories=void 0)}var d="http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=50&callback=JSON_CALLBACK&q={0}",e=a.$watch("component.content",function(){c(a.component.content.rssFeedUrl)},!0);a.$on("$destroy",e)}])}(window.angular),function(a){a.module("Cerberus.TemplateEngine").controller("Cerberus.TemplateEngine.Controller.Component.SocialMedia.Sharer",["$scope",function(a){var b=window.location.href;a.socialMedia={facebook:String.format("http://www.facebook.com/sharer/sharer.php?u={0}",b),twitter:String.format("http://twitter.com/intent/tweet?url={0}",b),googlePlus:String.format("https://plus.google.com/share?url={0}",b)}}])}(window.angular),function(a){a.module("Cerberus.TemplateEngine").directive("csComponent",[function(){return{restrict:"E",link:function(a,b){var c=a.component;b.attr({id:"TC"+c.id,"class":c.name.toLowerCase()})},controller:["$scope","$controller",function(a,b){b(a.component.componentType,{$scope:a})}]}}])}(window.angular),function(a){a.module("Cerberus.TemplateEngine").directive("csTemplate",["Cerberus.TemplateEngine.Service.DataBag",function(a){return{restrict:"E",scope:{},controller:["$scope","Cerberus.TemplateEngine.Service.Event","Cerberus.TemplateEngine.Service.PathResolver",function(b,c,d){b.template=a.getData("Template"),b.getComponentPath=function(a){return d.resolve(String.format("view/component/{0}/{1}.html",a.category,a.name))},c.subscribe("InitializeTemplate",function(a){b.template=a})}],template:function(a,b){var c="View"!==(b.templateMode||"View"),d="",e="";return c&&(d='friendly-name="{{component.friendlyName}}" component-name="{{component.name}}"',e='ng-attr-style="{{component.visualProperties}}"'),String.format('<cs-component ng-repeat="component in template.components track by component.id"               {0} {1}               ng-class="component.class"               ng-include="::getComponentPath(component)"></cs-component>',d,e)}}}])}(window.angular),function(a){a.module("Cerberus.TemplateEngine").filter("trustedUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}])}(window.angular),function(a){a.module("Cerberus.ModelFactory").registerModel("Cerberus.TemplateEngine.Model.Component",function(){this.id=0,this.friendlyName="",this.name="",this.visualProperties="",this.componentType="",this.category="basic",this.creationGUID="",this["class"]="",this.content={}})}(window.angular),function(a){a.module("Cerberus.ModelFactory").registerModel("Cerberus.TemplateEngine.Model.Component.Basic.Video",function(){this.mp4SourceUrl="",this.oggSourceUrl="",this.autoPlay=!1,this.showControls=!1,this.loopInfinitely=!1,this.posterUrl=""})}(window.angular),function(a){a.module("Cerberus.ModelFactory").registerModel("Cerberus.TemplateEngine.Model.Component.Basic.YouTube",function(){this.videoId="",this.startTime="",this.autoPlay=!1,this.showControls=!0,this.disableKeyboard=!1,this.loopInfinitely=!1,this.hideYouTubeBrand=!1,this.showVideoInfo=!0,this.videoIdQueryParameter=""})}(window.angular),function(a){a.module("Cerberus.ModelFactory").registerModel("Cerberus.TemplateEngine.Model.Component.Navigation.Link",function(){this.url="",this.tooltip="",this.text="",this.target=""})}(window.angular),function(a){a.module("Cerberus.ModelFactory").registerModel("Cerberus.TemplateEngine.Model.Component.SocialMedia.RSS",function(){this.rssFeedUrl="",this.showTitle=!0,this.showDescription=!0,this.showStoryDescription=!0,this.showStoryDate=!0,this.maxStories=5})}(window.angular),function(a){a.module("Cerberus.ModelFactory").registerModel("Cerberus.TemplateEngine.Model.Component.SocialMedia.Sharer",function(){this.facebook=!0,this.twitter=!0,this.googlePlus=!0})}(window.angular),function(a){a.module("Cerberus.ModelFactory").registerModel("Cerberus.TemplateEngine.Model.Resolution",function(a){this.id=0,this.resolutionValue=~~a||1e4,this.componentVisualProperties={}})}(window.angular),function(a){a.module("Cerberus.ModelFactory").registerModel("Cerberus.TemplateEngine.Model.Template",function(){this.name="",this.id=0,this.visualProperties="",this.createdDateAsString="",this.lastModifiedDateAsString="",this.components=[],this.resolutions=[]})}(window.angular),function(a){a.module("Cerberus.TemplateEngine").constant("Cerberus.TemplateEngine.TemplateMode",{editDesign:0,editContent:1,view:2})}(window.angular),function(a){a.module("Cerberus.TemplateEngine").service("Cerberus.TemplateEngine.Service.DataBag",function(){var a={};this.addData=function(b,c){a[b.toLowerCase()]=c},this.getData=function(b){return a[b.toLowerCase()]},this.removeData=function(b){delete a[b.toLowerCase()]}})}(window.angular),function(a,b){function c(a){var c={},d=!1;this.hasEventsOfType=function(a){return void 0!==c[a]},this.subscribe=function(a,d,e){var f,g=b.isArray(a)?a:[a];b.forEach(g,function(a){f=c[a]||(c[a]=[]),e&&(d=d.bind(e)),f.push(d)})},this.unSubscribe=function(a,d){var e=c[a];e&&(b.remove(e,function(a){return a===d}),e.length||delete c[a])},this.unSubscribeAll=function(a){delete c[a]},this.notify=function(e,f,g){var h=!1;d||(d=!0,h=!0);var i=c[e];b.forEach(i,function(a){a&&a(f,g)}),h&&setTimeout(function(){d=!1,a.$digest()})},this.clear=function(){c={}}}a.module("Cerberus.TemplateEngine").service("Cerberus.TemplateEngine.Service.Event",["$rootScope",c])}(window.angular,window._),function(a){a.module("Cerberus.TemplateEngine").service("Cerberus.TemplateEngine.Service.PathResolver",["templateEnginePath",function(a){this.resolve=function(b){return a+b}}])}(window.angular),function(a){var b=a.module("Cerberus.ModelFactory");a.module("Cerberus.TemplateEngine").provider("Cerberus.TemplateEngine.Service.Template",[function(){var a=b.getModelType("Cerberus.TemplateEngine.Service.TemplateLocalStorageProvider"),c=null;this.setProvider=function(b,d){a=b,c=d},this.$get=["$injector",function(b){var d=b.instantiate(a);return c&&d.configure(c),d}]}])}(window.angular),function(a,b,c){function d(a){function d(){c.setItem("TemplateRepository",JSON.stringify(f))}var f=JSON.parse(c.getItem("TemplateRepository"));f&&f.templates||(f={templates:{}}),this.configure=function(){},this.getTemplate=function(b,c,d){return a.when(f.templates[b])},this.removeTemplate=function(b){return delete f.templates[b],d(),a.when(!0)},this.saveTemplate=function(c){return a.when(c).then(function(a){a.id<=0&&(a.id=~~b.max(f.templates,function(a){return a.id}).id+1),f.templates[a.id]=a,a.resolutions.length||a.resolutions.push(e.instantiateModel("Cerberus.TemplateEngine.Model.Resolution"));var c=a.components,g=a.resolutions,h=b.filter(g,function(a){return 0===a.id}),i=~~Math.max(0,b.max(c,function(a){return a.id}).id),j=~~Math.max(0,b.max(g,function(a){return a.id}).id),k=b.filter(c,function(a){return a.id<0});return b.forEach(h,function(a){a.id=++j}),b.forEach(k,function(a){var c=a.id;a.id=++i,b.forEach(g,function(b){b.componentVisualProperties[a.id]=b.componentVisualProperties[c],delete b.componentVisualProperties[c]})}),f.templates[a.id]=a,d(),a})},this.cloneTemplate=function(a,b,c){},this.getTemplates=function(){var c=b.map(f.templates,function(a){return a});return a.when(c)},this.getTemplateInfo=function(a){return this.getTemplate(a)},this.saveTemplateInfo=function(a){},this.getDocument=function(a,b,c){},this.saveDocument=function(a,b,c){},this.getComponentPlugins=function(){return a.when([{id:1,name:"text",category:"basic",componentType:"Cerberus.TemplateEngine.Controller.Component.Basic.Text",imageUrl:"text.png"},{id:2,name:"video",category:"basic",componentType:"Cerberus.TemplateEngine.Controller.Component.Basic.Video",imageUrl:"video.png"},{id:3,name:"youTube",category:"basic",componentType:"Cerberus.TemplateEngine.Controller.Component.Basic.YouTube",imageUrl:"youTube.png"},{id:4,name:"link",category:"navigation",componentType:"Cerberus.TemplateEngine.Controller.Component.Navigation.Link",imageUrl:"link.png"},{id:5,name:"rss",category:"socialMedia",componentType:"Cerberus.TemplateEngine.Controller.Component.SocialMedia.Rss",imageUrl:"rss.png"},{id:6,name:"sharer",category:"socialMedia",componentType:"Cerberus.TemplateEngine.Controller.Component.SocialMedia.Sharer",imageUrl:"sharer.png"}])}}var e=a.module("Cerberus.ModelFactory");e.registerModel("Cerberus.TemplateEngine.Service.TemplateLocalStorageProvider",a.extend(d,{$inject:["$q"]}))}(window.angular,window._,window.localStorage),function(a){function b(b,c){function d(a){var b=c.defer();return a.then(function(a){b.resolve(a.data)})["catch"](function(){b.reject()}),b.promise}function e(){return a.extend([],arguments).slice(0).join("/")}function f(){var a=c.defer();return a.resolve(),a.promise}function g(){var a=c.defer();return a.reject(),a.promise}var h="";this.configure=function(a){h=a},this.getTemplate=function(a){return a>0?d(b.get(e(h,"template",~~a))):f()},this.removeTemplate=function(a){return a>0?d(b["delete"](e(h,"template",~~a))):g()},this.saveTemplate=function(a){return void 0!==a?d(b.put(e(h,"template"),a)):g()},this.cloneTemplate=function(a){return a>0?d(b.post(e(h,"template",~~a,"clone"))):g()},this.getTemplates=function(){return d(b.get(e(h,"templates")))},this.getTemplateInfo=function(a){return a>0?d(b.get(e(h,"templateinfo",~~a))):f()},this.saveTemplateInfo=function(a){return void 0!==a?d(b.put(e(h,"templateinfo"),a)):g()},this.getDocument=function(a,c,f){return d(b.get(e(h,"templatecontent",~~a,~~c,~~f)))},this.saveDocument=function(a,c,f){return d(b.put(e(h,"templatecontent",~~c,f),a))},this.getComponentPlugins=function(){return d(b.get(e(h,"componentplugins")))}}var c=a.module("Cerberus.ModelFactory");c.registerModel("Cerberus.TemplateEngine.Service.TemplateRestProvider",a.extend(b,{$inject:["$http","$q"]}))}(window.angular),function(a){a.module("Cerberus.TemplateEngine").run(["$templateCache","templateEnginePath",function(a,b){a.put(b+"view/component/basic/rtf.html","<span ng-bind-html=component.content.text></span>"),a.put(b+"view/component/basic/text.html","<pre ng-bind=component.content.text></pre>"),a.put(b+"view/component/basic/video.html",' <video cs-video poster="{{component.content.posterUrl | trustedUrl}}">  <source type="video/mp4"> <source type="video/ogg"> </video>'),a.put(b+"view/component/basic/youTube.html",'<div class=youtube> <iframe ng-src="{{videoUrl | trustedUrl}}" frameborder=0 allowfullscreen></iframe> <div ng-class="{\'valid-link\': isValidLink}"></div> </div>'),a.put(b+"view/component/navigation/link.html",'<a ng-href="{{ content.url }}" title="{{ content.tooltip }}" target="{{ content.target }}" ng-bind=content.text></a>'),a.put(b+"view/component/socialMedia/rss.html",'<h1 ng-bind=rssFeed.title ng-show=component.content.showTitle></h1> <span ng-bind=rssFeed.description ng-show=component.content.showDescription></span> <ul> <li ng-repeat="story in stories|limitTo:component.content.maxStories"> <span class=date ng-bind=::story.publishedDate ng-show=component.content.showStoryDate></span> <a ng-href={{::story.link}} ng-bind=::story.title></a> <span ng-bind=::story.contentSnippet ng-show=component.content.showStoryDescription></span> </li> </ul>'),a.put(b+"view/component/socialMedia/sharer.html",'<a target=_blank ng-attr-href={{::socialMedia.facebook}} class="social-media-icon facebook" ng-show=component.content.facebook></a> <a target=_blank ng-attr-href={{::socialMedia.twitter}} class="social-media-icon twitter" ng-show=component.content.twitter></a> <a target=_blank ng-attr-href={{::socialMedia.googlePlus}} class="social-media-icon google-plus" ng-show=component.content.googlePlus></a>')}])}(window.angular);