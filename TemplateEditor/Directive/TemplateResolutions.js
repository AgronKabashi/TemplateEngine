define(["../App.js"],function(a){return a.constant("MaxResolutionCount",10).constant("MaxResolutionValue",1024).constant("MaxResolutionDifference",20).directive("templateresolutions",["MaxResolutionValue","Cerberus.Tool.TemplateEditor.Helper.TemplateEditor",function(a,b){return{restrict:"E",templateUrl:"View/TemplateResolutions.html",link:function(c,d){{var e=$(".template:first-child"),f=d.find(".resolution-slider");d.find(".resolution-container")}c.$on("ResolutionSelected",function(b,c){f.slider("value",c).children().first().attr("data-value",Math.min(c,a)),e.css("width",c+"px")}),f.slider({step:1,value:a,max:a,slide:function(a,d){var f=~~d.value;$(this).children().first().attr("data-Value",f),e.css("width",f+"px");var g=b.FindResolution(c.Template,f);(null==c.CurrentResolution||c.CurrentResolution&&g&&g.ResolutionValue!=c.CurrentResolution.ResolutionValue)&&(c.CurrentResolution=g,c.SetDocumentWidth(f,c.CurrentResolution),c.$apply())},stop:function(a,b){var d=~~b.value;$(this).children().first().attr("data-Value",d),e.css("width",d+"px"),c.SliderValue=d}}).children().first().attr("data-value",f.outerWidth())},controller:["$scope","MaxResolutionCount","MaxResolutionValue","MaxResolutionDifference","Cerberus.Tool.TemplateEditor.Localization","Cerberus.Tool.TemplateEngine.Service.DataBag",function(a,c,d,e,f,g){a.MaxResolutionValue=d,a.SliderValue=d,a.DataBagService=g,g.GetData("Template").then(function(b){a.Template=b,a.CurrentResolution=b.Resolutions[b.Resolutions.length-1],a.SetDocumentWidth(b.Resolutions[b.Resolutions.length-1].ResolutionValue)}),a.ResolutionPresets=[{Name:"640px - Apple iPhone 4&5",Value:640},{Name:"768px - Apple iPad 1&2",Value:768}],a.$on("ReloadTemplate",function(b,c){a.Template=c}),a.$on("TemplateControlUpdated",function(a,c){b.OnTemplateControlUpdate(a.currentScope,c)}),a.$on("TemplateControlAdded",function(a,c){b.OnTemplateControlUpdate(a.currentScope,c)}),a.AddResolution=function(g){var h=a.Template,i=new Cerberus.Tool.TemplateEngine.Model.Resolution,j=Math.min(null!=g?g.Value:a.SliderValue,d),k=b.FindResolution(h,j);if(h.Resolutions.length>=c)return void a.$emit("ShowMessage",f.TemplateControlResolutions.ReachedMaximumResolutions);var l=b.FindResolution(h,j-e),m=b.FindResolution(h,j+e);return Math.abs(j-l.ResolutionValue)<=e||Math.abs(j-m.ResolutionValue)<=e?void a.$emit("ShowMessage",f.TemplateControlResolutions.NotEnoughSpace):(i.ResolutionValue=j,i.TemplateControlVisualProperties=JSON.parse(JSON.stringify(k.TemplateControlVisualProperties)),h.Resolutions.push(i),a.CurrentResolution=i,h.Resolutions.sort(function(a,b){return a.ResolutionValue-b.ResolutionValue}),void(a.PresetsExpanded=!1))},a.RemoveResolution=function(b){a.Template.Resolutions.RemoveValue("ResolutionValue",b.ResolutionValue),a.SetDocumentWidth(b.ResolutionValue)},a.SetDocumentWidth=function(c,d){a.SliderValue=c,d=d||b.FindResolution(a.Template,c),a.CurrentResolution=d,g.AddData("CurrentResolution",d),b.RemapTemplateControlVisualProperties(a.Template,d),a.$emit("ResolutionSelected",c)}}]}}])});